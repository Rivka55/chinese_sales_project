<div class="cart-page">
  <div class="page-header">
    <h2>🛒 סל הקניות שלי</h2>
  </div>

  @if (isLoading) {
    <div class="loading-state">
      <div class="loading-spinner">⏳</div>
      <p>טוען את הסל...</p>
    </div>
  }

  @if (errorMsg) {
    <div class="error-state">
      <div class="error-icon">⚠️</div>
      <p>{{ errorMsg }}</p>
      <button class="btn-retry" (click)="loadCart()">🔄 נסה שוב</button>
    </div>
  }

  @if (!isLoading && !errorMsg && items.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">🛒</div>
      <h3>הסל שלך ריק כרגע</h3>
      <p>הוסף מתנות מדף המתנות כדי להשתתף בהגרלה!</p>
      <a routerLink="/gifts" class="btn-go-gifts">🎁 עבור למתנות</a>
    </div>
  }

  @if (!isLoading && items.length > 0) {
  <div class="cart-table-wrap">
    <table class="cart-table">
      <thead>
        <tr>
          <th>מתנה</th>
          <th>תיאור</th>
          <th>מחיר לכרטיס</th>
          <th>כמות</th>
          <th>סה"כ</th>
          <th>פעולות</th>
        </tr>
      </thead>
      <tbody>
        @for (item of items; track item.id) {
        <tr>
          <td><strong>{{ item.giftName }}</strong></td>
          <td class="desc-cell">{{ item.giftDescription }}</td>
          <td>{{ item.price }} ₪</td>
          <td>
            <div class="qty-controls">
              <button class="qty-btn" (click)="updateQty(item.id, item.quantity, -1)" [disabled]="item.quantity <= 1">−</button>
              <span class="qty-display">{{ item.quantity }}</span>
              <button class="qty-btn" (click)="updateQty(item.id, item.quantity, 1)">+</button>
            </div>
          </td>
          <td class="price-cell">{{ item.totalPrice }} ₪</td>
          <td>
            <button class="btn-remove" (click)="removeItem(item.id)">🗑️</button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="cart-summary">
    <div class="summary-total">
      <span>סה"כ לתשלום:</span>
      <strong>{{ totalCartPrice }} ₪</strong>
    </div>
    <div class="summary-actions">
      <button class="btn-purchase" (click)="onPurchase()">✅ בצע רכישה סופית</button>
      <button class="btn-clear-cart" (click)="clearCart()">🗑️ נקה סל</button>
    </div>
  </div>
  }
</div>