<div class="reports-page">
  <div class="page-header">
    <h2>ğŸ“Š ×œ×•×— ×‘×§×¨×” - ×“×•×—×•×ª</h2>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab" [class.active]="activeTab === 'revenue'" (click)="switchTab('revenue')">ğŸ’° ×”×›× ×¡×•×ª</button>
    <button class="tab" [class.active]="activeTab === 'winners'" (click)="switchTab('winners')">ğŸ† ×–×•×›×™×</button>
    <button class="tab" [class.active]="activeTab === 'topGift'" (click)="switchTab('topGift')">â­ ××ª× ×” ××•×‘×™×œ×”</button>
    <button class="tab" [class.active]="activeTab === 'purchasers'" (click)="switchTab('purchasers')">ğŸ‘¥ ×§×•× ×™×</button>
  </div>

  @if (loading) {
    <div class="loading-state">×˜×•×¢×Ÿ × ×ª×•× ×™×...</div>
  }

  <!-- ===== REVENUE TAB ===== -->
  @if (activeTab === 'revenue' && !loading) {
  <div class="tab-content">
    @if (revenueSummary) {
    <div class="stats-grid">
      <div class="stat-card purple">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-value">{{ revenueSummary.totalRevenue }} â‚ª</div>
        <div class="stat-label">×¡×”"×› ×”×›× ×¡×•×ª</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-icon">ğŸ«</div>
        <div class="stat-value">{{ revenueSummary.totalTicketsSold }}</div>
        <div class="stat-label">×›×¨×˜×™×¡×™× ×©× ××›×¨×•</div>
      </div>
      <div class="stat-card green">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-value">{{ revenueSummary.totalParticipants }}</div>
        <div class="stat-label">××©×ª×ª×¤×™×</div>
      </div>
    </div>
    } @else {
      <div class="empty-state">××™×Ÿ × ×ª×•× ×™ ×”×›× ×¡×•×ª ×¢×“×™×™×Ÿ</div>
    }
  </div>
  }

  <!-- ===== WINNERS TAB ===== -->
  @if (activeTab === 'winners' && !loading) {
  <div class="tab-content">
    @if (winners.length === 0) {
      <div class="empty-state">×¢×“×™×™×Ÿ ×œ× ×”×•×’×¨×œ×• ×–×•×›×™×</div>
    }
    <div class="winners-list">
      @for (w of winners; track w.giftName) {
      <div class="winner-card">
        <div class="winner-gift">ğŸ {{ w.giftName }}</div>
        <div class="winner-info">
          <span class="winner-name">ğŸ† {{ w.winnerName }}</span>
          <span class="winner-email">ğŸ“§ {{ w.contactEmail }}</span>
        </div>
      </div>
      }
    </div>
  </div>
  }

  <!-- ===== TOP GIFT TAB ===== -->
  @if (activeTab === 'topGift' && !loading) {
  <div class="tab-content">
    <div class="criteria-row">
      <label>×§×¨×™×˜×¨×™×•×Ÿ:</label>
      <select [(ngModel)]="topGiftCriteria" (ngModelChange)="loadTopGift()" class="criteria-select">
        <option value="tickets">××¡×¤×¨ ×›×¨×˜×™×¡×™×</option>
        <option value="revenue">×”×›× ×¡×•×ª</option>
      </select>
    </div>

    @if (topGift) {
    <div class="top-gift-card">
      <div class="top-icon">â­</div>
      <h3>{{ topGift.giftName }}</h3>
      <div class="top-stats">
        <div class="top-stat">
          <span class="value">{{ topGift.price }} â‚ª</span>
          <span class="label">××—×™×¨ ×›×¨×˜×™×¡</span>
        </div>
        <div class="top-stat">
          <span class="value">{{ topGift.totalTicketsPurchased }}</span>
          <span class="label">×›×¨×˜×™×¡×™× ×©× ××›×¨×•</span>
        </div>
        <div class="top-stat">
          <span class="value">{{ topGift.totalEarned }} â‚ª</span>
          <span class="label">×¡×”"×› ×”×›× ×¡×•×ª</span>
        </div>
      </div>
    </div>
    } @else {
      <div class="empty-state">××™×Ÿ × ×ª×•× ×™× ×¢×“×™×™×Ÿ</div>
    }
  </div>
  }

  <!-- ===== PURCHASERS TAB ===== -->
  @if (activeTab === 'purchasers' && !loading) {
  <div class="tab-content">
    @if (purchasers.length === 0) {
      <div class="empty-state">××™×Ÿ ×¨×›×™×©×•×ª ×‘××¢×¨×›×ª</div>
    }

    @for (p of purchasers; track p.userId) {
    <div class="purchaser-card" [class.expanded]="expandedPurchaser?.userId === p.userId">
      <div class="purchaser-header" (click)="togglePurchaser(p)">
        <div class="purchaser-main">
          <strong>ğŸ‘¤ {{ p.name }}</strong>
          <span class="purchaser-meta">ğŸ“§ {{ p.email }} Â· ğŸ“± {{ p.phone }}</span>
        </div>
        <div class="purchaser-summary">
          <span class="badge tickets">ğŸ« {{ p.totalTicketsPurchased }}</span>
          <span class="badge money">ğŸ’° {{ p.grandTotalSpent }} â‚ª</span>
          <span class="expand-icon">{{ expandedPurchaser?.userId === p.userId ? 'â–²' : 'â–¼' }}</span>
        </div>
      </div>

      @if (expandedPurchaser?.userId === p.userId && p.purchaseHistory) {
      <div class="purchaser-details">
        <table class="history-table">
          <thead>
            <tr>
              <th>××ª× ×”</th>
              <th>×›××•×ª</th>
              <th>××—×™×¨ ×œ×™×—'</th>
              <th>×¡×”"×›</th>
              <th>×ª××¨×™×š</th>
            </tr>
          </thead>
          <tbody>
            @for (h of p.purchaseHistory; track h.giftName) {
            <tr>
              <td><strong>{{ h.giftName }}</strong></td>
              <td>{{ h.quantity }}</td>
              <td>{{ h.pricePerUnit }} â‚ª</td>
              <td class="price-cell">{{ h.totalPrice }} â‚ª</td>
              <td>{{ h.purchaseDate | date:'dd/MM/yyyy HH:mm' }}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }
    </div>
    }
  </div>
  }
</div>
